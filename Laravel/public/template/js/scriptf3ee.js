jQuery(document).ready(function(){$(".support-btn").click(function(){var sefl=$(this);removeSelectBtn();sefl.removeClass("btn-default");sefl.addClass("btn-primary");$("."+$(this).attr("data-class")).show();});function removeSelectBtn(){$(".support-btn").each(function(index){if($(this).hasClass("btn-primary")){$(this).removeClass("btn-primary");$(this).addClass("btn-default");$("."+$(this).attr("data-class")).hide();}});}$.validator.addMethod("regex",function(value,element,regexp){var check=false;return this.optional(element)||regexp.test(value);},"Please check your input.");jQuery.validator.addMethod("phone",function(value,element){var $reg1=/^01\d{9}$/,$reg2=/^09\d{8}$/,$reg3=/^0[2-8]\d{8}$/;return this.optional(element)||$reg1.test(value)||$reg2.test(value)||$reg3.test(value);},"Số điện thoại không hợp lệ.");$("#sendpwtoemail").validate({rules:{username:{required:true,minlength:4,maxlength:100,remote:{url:'validate-field.php',type:'POST',cache:false,dataType:'JSON',data:{username:function(){return $('#username').val();},validate:'usernameFound'}}},email:{required:true,email:true}},messages:{username:{required:"Bạn chưa nhập Tên đăng nhập.",minlength:"Tên đăng nhập phải có ít nhất 4 kí tự.",maxlength:"Tên đăng nhập phải ít hơn 100 kí tự."},email:{required:"Địa chỉ Email không được để trống.",email:"Định dạng Email không hợp lệ."}}});$("#sendpwtosms").validate({rules:{username:{required:true,minlength:4,maxlength:100,remote:{url:'validate-field.php',type:'POST',cache:false,dataType:'JSON',data:{username:function(){return $('#username2').val();},validate:'usernameEmailFound'}}},phone:{required:true,phone:true}},messages:{username:{required:"Bạn chưa nhập Tên đăng nhập.",minlength:"Tên đăng nhập phải có ít nhất 4 kí tự.",maxlength:"Tên đăng nhập phải ít hơn 100 kí tự."},phone:{required:"Bạn chưa nhập số điện thoại.",phone:"Số điện thoại không hợp lệ."}},submitHandler:function(form){var thisForm=$(form);if(thisForm.valid()){$.ajax({url:'forgot_password_sms.php',type:'POST',data:thisForm.serialize(),dataType:'JSON',success:function(response){switch(response.status){case'success':$('#alertSMS').find('.modal-body').html(response.message);$('#alertSMS').modal('show');thisForm.find('.alertMsg').html('');thisForm.find($('#username2')).val('');thisForm.find($('#phone')).val('');break;case'error':thisForm.find('.alertMsg').html('<div class="alert alert-danger">'+response.message.replace(/\\/g,"")+'</div>');break;}}});}}});$("#signupforms").validate({rules:{name:{required:true,minlength:4,maxlength:100,regex:/^[a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợụủứừỬỮỰỲỴÝỶỸửữựỳýỵỷỹ]([-']?[a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợụủứừỬỮỰỲỴÝỶỸửữựỳýỵỷỹ]+)*( [a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợụủứừỬỮỰỲỴÝỶỸửữựỳýỵỷỹ]([-']?[a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợụủứừỬỮỰỲỴÝỶỸửữựỳýỵỷỹ]+)*)+$/},emailtxt:{required:true,email:true,remote:{url:'validate-field.php',type:'POST',cache:false,dataType:'JSON',data:{email:function(){return $('#emailtxt').val();},validate:'email'}}},passwordtxt:{required:true,minlength:8,maxlength:100,regex:/.{8,100}$/},repaswordtxt:{equalTo:"#passwordtxt"}},messages:{name:{required:"Họ và tên không được để trống.",minlength:"Họ và tên phải có ít nhất 4 kí tự.",maxlength:"Họ và tên không vượt quá 100 kí tự.",regex:"Họ và tên chỉ bao gồm chữ (viết hoa, viết thường) và có ít nhất hai từ tách biệt."},emailtxt:{required:"Email không được để trống.",email:"Định dạng email không hợp lệ."},passwordtxt:{required:"Mật khẩu không được để trống.",minlength:"Mật khẩu phải có ít nhất 8 kí tự.",maxlength:"Mật khẩu không vượt quá 100 kí tự.",regex:"Mật khẩu có độ dài từ 8 ký tự trở lên. Mật khẩu nên bao gồm cả chữ (viết hoa, viết thường), số và các ký tự đặc biệt như *, &, @..."},repaswordtxt:{equalTo:"Xác nhận mật khẩu không khớp. Vui lòng nhập lại."}},submitHandler:function(form){var thisForm=$(form);if(thisForm.valid()){$.ajax({url:"register.php",method:"POST",data:{name:$("#name").val(),password:$("#passwordtxt").val(),email:$("#emailtxt").val()},dataType:"JSON",success:function(response){switch(response.status){case'success':window.location.href='index.html';break;case'error':thisForm.find('.alertMsg').html('<div class="alert alert-danger">'+response.message+'</div>');break;}}});}}});function checkStrength(password){var strength=0;if(password.length<4){return'Quá ngắn';}if(password.length>7)strength+=1;if(password.match(/([a-z].*[A-Z])|([A-Z].*[a-z])/))strength+=1;if(password.match(/([a-zA-Z])/)&&password.match(/([0-9])/))strength+=1;if(password.match(/([!,%,&,@,#,$,^,*,?,_,~])/))strength+=1;if(password.match(/(.*[!,%,&,@,#,$,^,*,?,_,~].*[!,%,&,@,#,$,^,*,?,_,~])/))strength+=1;if(strength<2){return'Yếu';}else if(strength==2){return'Khá tốt';}else{return'Mạnh';}}$('#signupforms #passwordtxt').on('keyup',function(e){var passInput=$(this).val();var passStrength=$('#pass-strength');var width=$(window).width();if(passInput.length){var strength=checkStrength(passInput);var title='Độ mạnh mật khẩu: '+strength;var content='Mật khẩu có độ dài từ 8 ký tự trở lên. Mật khẩu nên bao gồm cả chữ (viết hoa, viết thường), số và các ký tự đặc biệt như *, &, @...';var html;if(strength=='Quá ngắn'){html='<div class="progress hm-progress"><div class="progress-bar" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" style="width: 10%; background: #a03;"></div></div>';}else if(strength=='Yếu'){html='<div class="progress hm-progress"><div class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%; background: #a03;"></div></div>';}else if(strength=='Khá tốt'){html='<div class="progress hm-progress"><div class="progress-bar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100" style="width: 70%; background: #FFD44B;"></div></div>';}else if(strength=='Mạnh'){html='<div class="progress hm-progress"><div class="progress-bar" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%; background: #76c261;"></div></div>';}if(width>768){passStrength.data('placement','left');}else{passStrength.data('placement','bottom');}passStrength.attr('data-original-title',title+html);passStrength.data('content',content);if(passStrength.data('bs.popover')){passStrength.data('bs.popover').options.content=content;}passStrength.popover('show');}else{passStrength.popover('hide');}});$('#signupforms #passwordtxt').focusout(function(){$('#pass-strength').popover('destroy');});$('#signupforms #name').click(function(){var content='Vui lòng nhập Họ và tên của bạn.';var username=$(this);var width=$(window).width();if(width<=768){username.data('placement','right');}else{username.data('placement','left');}//tendangnhapusername.data('content',content);username.popover('show');});$('#signupforms #username').focusout(function(){$(this).popover('destroy');});$('#signupforms #username').click(function(){var content='Vui lòng nhập tên đăng nhập.';var username=$(this);var width=$(window).width();if(width<=768){username.data('placement','right');}else{username.data('placement','left');}username.data('content',content);username.popover('show');});$('#signupforms #name').focusout(function(){$(this).popover('destroy');});$('#signupforms #emailtxt').click(function(){var content='Chúng tôi sẽ sử dụng địa chỉ Email này cho những việc như bảo mật tài khoản của bạn, gửi thông báo cho bạn. Vui lòng nhập chính xác địa chỉ email của bạn.';var email=$(this);var width=$(window).width();if(width<=768){email.data('placement','right');}else{email.data('placement','left');}email.data('content',content);email.popover('show');});$('#signupforms #emailtxt').focusout(function(){$(this).popover('destroy');});$('#sso-form').validate({rules:{username:{required:true},password:{required:true}},messages:{username:{required:'Tên tài khoản không được để trống.'},password:{required:'Mật khẩu không được để trống.'}}});$('#profile-form select').select2();$('#profile-form').validate({rules:{banla:{required:true},phone:{required:true,phone:true},city:{required:true},district:{required:true},school_class:{required:true},school:{required:true}},messages:{banla:{required:'Bạn là học sinh, phụ huynh hay giáo viên?'},phone:{required:'Số điện thoại không được để trống.',phone:'Số điện thoại không hợp lệ.'},city:{required:'Bạn chưa chọn tỉnh/thành phố.'},district:{required:'Bạn chưa chọn quận/huyện.'},school_class:{required:'Bạn chưa chọn lớp.'},school:{required:'Bạn chưa chọn trường.'}},submitHandler:function(form){var thisForm=$(form);$.ajax({url:'update-profile.php',method:'post',data:thisForm.serialize(),dataType:'json',success:function(response){switch(response.status){case'success':window.location.href='comfirmsuccess.html';break;case'error':thisForm.find('.alertMsg').html('<div class="alert alert-danger">'+response.message.replace(/\\/g,"")+'</div>');break;}}})}});function getDistrict(city,callback){$.post('get-district.html',{city:city},function(data){if(typeof callback==='function'){callback(data);}},'JSON');}function getSchools(city,district,schoolClass,callback){if(schoolClass==''){schoolClass=0;}if(district==''){district='';}$.post('getschool.html',{city:city,district:district,schoolClass:schoolClass},function(data){if(typeof callback==='function'){callback(data);}},'JSON');}$('#banla').change(function(){$('#schoolClass').val('');$('#school').val('');if($(this).val()==0){$('#schoolClass').prop('disabled',false).trigger('change');$('#school').prop('disabled',false).trigger('change');}else{$('#schoolClass').prop('disabled',true).trigger('change');$('#school').prop('disabled',true).trigger('change');}});$('#city').change(function(){var city=$(this).val();$('#district').html('<option value="" selected>--Chọn quận/huyện--</option>').trigger('change');$('#schoolClass').val('').trigger('change');$('#school').html('<option value="" selected>--Chọn trường--</option>').trigger('change');if(city!=''){getDistrict(city,function(data){var sl=$('#district');sl.empty();sl.append('<option value="" selected>--Chọn quận/huyện--</option>');if(data.status=='success'){for(var i=0;i<data.data.length;i++){sl.append('<option value="'+data.data[i].name+'">'+data.data[i].displayName+'</option>')}}sl.select2();if(districtShort){sl.val(districtShort);sl.trigger('change');districtShort='';}});}});$('#district').change(function(){var district=$(this).val();var city=$('#city').val();$('#schoolClass').val('').trigger('change');$('#school').html('<option value="">--Chọn trường--</option>').trigger('change');if(city!=''&&district!=''){var schoolClass=$('select[name="school_class"]');var schoolClassData=schoolClass.val();getSchools(city,district,schoolClassData,function(data){var sl=$('select[name="school"]');sl.empty();sl.append('<option value="" selected>--Chọn trường--</option>');if(data.status=='success'){for(var i=0;i<data.data.length;i++){sl.append('<option value="'+data.data[i].id+'">'+data.data[i].name+'</option>')}}sl.select2();if(schoolId>0){sl.val(schoolId);sl.trigger('change');schoolId=0;}});}});$('select[name="school_class"]').change(function(){var districtSelect=$('#district');var district=districtSelect.val();var citySelect=$('#city');var city=citySelect.val();var schoolClassData=$(this).val();$('#school').html('<option value="">--Chọn trường--</option>').trigger('change');if(city!=''&&district!=''&&schoolClassData!=''){getSchools(city,district,schoolClassData,function(data){var sl=$('select[name="school"]');sl.empty();sl.append('<option value="" selected>--Chọn trường--</option>');if(data.status=='success'){for(var i=0;i<data.data.length;i++){sl.append('<option value="'+data.data[i].id+'">'+data.data[i].name+'</option>')}}sl.select2();});}});});